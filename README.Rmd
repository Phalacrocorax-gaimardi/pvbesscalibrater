---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pvbesscalibrater

<!-- badges: start -->
<!-- badges: end -->

The goal of pvbesscalibrater is to create a set of weights and empirical partial utilities used by pvbessmicrosimr. This is the micro-calibration step of the ABM. 

Tasks that pvbesscalibrater handles include

* mapping survey adoption likert scores to partial utilities using a parameter (epsilon) that describes hypothetical bias
* choice of financial variable(s) in ABM (usually highest bill q14, annual bill q_ab or highest and lowest bills q14 and q15)
* finds a set of regularised weights for financial, social and barrier terms


## Installation

You can install the development version of pvbesscalibrater like so:

``` r
remotes::install_github(")
```

```{r example}
library(pvbesscalibrater)
library(tidyverse)
## basic example code
```

## Workflow



### Preliminary

pvbessmicrosimr has two datasets included: pv_survey and pv_survey_oo (restricted to owner-occupiers only)

An initial feature selection choosing q14 (highest 2023 bill) as financial variable
```{r}
pv_data <- feature_select(pv_survey_oo,recode_bills=F,drop_lowestbills = T)
```
Transform to adoption utilities (u) instead of LTA likert scores. This involves choice of a parameter $\epsilon$ that controls the mapping between stated LTA and utility. $\epsilon=1$ means no hypothetical bias. $\epsilon=0.7$ is a reasonable choice. 
An initial feature selection choosing q14 (highest 2023 bill) as financial variable
```{r}
pv_data <- transform_to_utils(pv_data,epsilon=0.7)

### 

```
Create boosted tree object using 5-fold cross validation
```{r results="hide"}
bst <- get_boosted_tree_model(pv_data)
```
Extract shap scores for individual agents and features from bst
```{r}
shap_scores_long <- get_shap_scores(pv_data,bst)

```
Find the empirical partial utilities for q14 and 



You can also embed plots, for example:

```{r pressure, echo = FALSE}
plot(pressure)
```

In that case, don't forget to commit and push the resulting figure files, so they display on GitHub and CRAN.
